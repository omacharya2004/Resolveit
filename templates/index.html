<!doctype html>
<html lang="en" data-bs-theme="dark">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>PingMe • Join</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="/static/style.css">
    <link rel="icon" href="{{ url_for('static', filename='logo.png') }}" type="image/png">
  </head>
  <body class="d-flex align-items-center" style="min-height:100vh">
    <div class="container">
      <div class="row justify-content-center">
        <div class="col-12 col-sm-10 col-md-8 col-lg-6">
          <div class="card shadow-sm">
            <div class="card-body p-4">
              <h1 class="h4 mb-3 d-flex align-items-center gap-2">
                <img src="{{ url_for('static', filename='logo.png') }}" alt="PingMe" style="height:36px;width:36px;border-radius:8px;object-fit:cover">
                <span>PingMe</span>
              </h1>
              <form method="post" action="/join">
                <div class="mb-3">
                  <label class="form-label">Room Code</label>
                  <div class="input-group">
                    <input id="room-input" name="room" class="form-control" value="{{ default_room }}" placeholder="4-digit code (e.g. 0427)" required>
                    <button class="btn btn-outline-secondary" type="button" id="gen-code">Generate</button>
                    <button class="btn btn-outline-primary" type="button" id="copy-code">Copy</button>
                  </div>
                  <div class="form-text">Digits only. We'll pad to 4 digits if needed.</div>
                </div>
                <button class="btn btn-primary w-100" type="submit">Join PingMe</button>
              </form>
              <div class="text-center mt-3">
                <a href="/logout">Switch account</a> · <a href="/about">About</a>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <script>
      (function(){
        const input = document.getElementById('room-input');
        const genBtn = document.getElementById('gen-code');
        const copyBtn = document.getElementById('copy-code');
        function digitsOnly(s){ return (s||'').replace(/\D+/g,'').slice(0,4); }
        function normalizeDigits(s){ const d = digitsOnly(s); return d.padStart(4,'0'); }
        genBtn.addEventListener('click', function(){
          const rand = Math.floor(Math.random()*10000).toString().padStart(4,'0');
          input.value = rand;
        });
        copyBtn.addEventListener('click', async function(){
          try{ await navigator.clipboard.writeText(input.value); copyBtn.textContent='Copied!'; setTimeout(()=>copyBtn.textContent='Copy',1200);}catch(e){}
        });
        input.addEventListener('input', function(){ input.value = digitsOnly(input.value); });
        input.addEventListener('keydown', function(e){ if (e.key==='Enter'){ /* form will submit; ensure padded */ input.value = normalizeDigits(input.value); } });
        input.addEventListener('blur', function(){ input.value = normalizeDigits(input.value); });
      })();
    </script>
  </body>
  </html>


